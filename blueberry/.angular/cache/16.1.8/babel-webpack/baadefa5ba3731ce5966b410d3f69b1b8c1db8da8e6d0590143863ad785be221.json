{"ast":null,"code":"import _defineProperty from \"/home/orcrist/Desktop/touchpanel-ui-microservice/blueberry/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport { MAT_DIALOG_DATA } from \"@angular/material/dialog\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/dialog\";\nimport * as i2 from \"../../services/data.service\";\nimport * as i3 from \"../../services/command.service\";\nimport * as i4 from \"../../services/graph.service\";\nimport * as i5 from \"@angular/common\";\nimport * as i6 from \"@angular/material/button\";\nimport * as i7 from \"@angular/material/grid-list\";\nimport * as i8 from \"../../components/activity-button/activity-button.component\";\nfunction ShareModalComponent_ng_container_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 1);\n    i0.ɵɵtext(2, \"There are no displays to share to.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n}\nfunction ShareModalComponent_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 1);\n    i0.ɵɵtext(2, \"Please select an input to share.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n}\nfunction ShareModalComponent_ng_container_2_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 1);\n    i0.ɵɵtext(2, \" This room isn't configured correctly to share this input. \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n}\nfunction ShareModalComponent_ng_container_2_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 1);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext(2);\n    let tmp_0_0;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r4.data == null ? null : ctx_r4.data.wheel == null ? null : (tmp_0_0 = ctx_r4.data.wheel.getInput()) == null ? null : tmp_0_0.displayname, \" can't be shared with any displays. \");\n  }\n}\nfunction ShareModalComponent_ng_container_2_ng_container_3_mat_grid_tile_5_button_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 13);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const p_r8 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", p_r8 == null ? null : p_r8.name, \" \");\n  }\n}\nfunction ShareModalComponent_ng_container_2_ng_container_3_mat_grid_tile_5_button_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"button\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const p_r8 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", p_r8 == null ? null : p_r8.name, \" \");\n  }\n}\nfunction ShareModalComponent_ng_container_2_ng_container_3_mat_grid_tile_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"mat-grid-tile\", 10);\n    i0.ɵɵlistener(\"click\", function ShareModalComponent_ng_container_2_ng_container_3_mat_grid_tile_5_Template_mat_grid_tile_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r14);\n      const p_r8 = restoredCtx.$implicit;\n      const ctx_r13 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r13.toggle(p_r8));\n    })(\"press\", function ShareModalComponent_ng_container_2_ng_container_3_mat_grid_tile_5_Template_mat_grid_tile_press_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r14);\n      const p_r8 = restoredCtx.$implicit;\n      const ctx_r15 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r15.toggle(p_r8));\n    });\n    i0.ɵɵtemplate(1, ShareModalComponent_ng_container_2_ng_container_3_mat_grid_tile_5_button_1_Template, 2, 1, \"button\", 11);\n    i0.ɵɵtemplate(2, ShareModalComponent_ng_container_2_ng_container_3_mat_grid_tile_5_button_2_Template, 2, 1, \"button\", 12);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const p_r8 = ctx.$implicit;\n    const ctx_r6 = i0.ɵɵnextContext(3);\n    i0.ɵɵproperty(\"colspan\", 1)(\"rowspan\", 1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r6.selected == null ? null : ctx_r6.selected.includes(p_r8));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", !(ctx_r6.selected == null ? null : ctx_r6.selected.includes(p_r8)));\n  }\n}\nfunction ShareModalComponent_ng_container_2_ng_container_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"h1\", 2);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 3)(4, \"mat-grid-list\", 4);\n    i0.ɵɵtemplate(5, ShareModalComponent_ng_container_2_ng_container_3_mat_grid_tile_5_Template, 3, 4, \"mat-grid-tile\", 5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 6)(7, \"button\", 7);\n    i0.ɵɵlistener(\"click\", function ShareModalComponent_ng_container_2_ng_container_3_Template_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r16 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r16.cancel());\n    })(\"press\", function ShareModalComponent_ng_container_2_ng_container_3_Template_button_press_7_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r18 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r18.cancel());\n    });\n    i0.ɵɵtext(8, \" Cancel \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"activity-button\", 8, 9);\n    i0.ɵɵlistener(\"success\", function ShareModalComponent_ng_container_2_ng_container_3_Template_activity_button_success_9_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r19 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r19.ref.close());\n    });\n    i0.ɵɵtext(11, \"Share\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const _r7 = i0.ɵɵreference(10);\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    let tmp_0_0;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" Select stations to share \", ctx_r5.data.wheel == null ? null : (tmp_0_0 = ctx_r5.data.wheel.getInput()) == null ? null : tmp_0_0.displayname, \" with \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"cols\", ctx_r5.colMap[ctx_r5.selections == null ? null : ctx_r5.selections.length]);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r5.selections);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", _r7 == null ? null : _r7.resolving());\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"click\", ctx_r5.data == null ? null : ctx_r5.data.share(ctx_r5.data == null ? null : ctx_r5.data.wheel == null ? null : ctx_r5.data.wheel.preset, ctx_r5.selected))(\"press\", ctx_r5.data == null ? null : ctx_r5.data.share(ctx_r5.data == null ? null : ctx_r5.data.wheel == null ? null : ctx_r5.data.wheel.preset, ctx_r5.selected));\n  }\n}\nfunction ShareModalComponent_ng_container_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, ShareModalComponent_ng_container_2_ng_container_1_Template, 3, 0, \"ng-container\", 0);\n    i0.ɵɵtemplate(2, ShareModalComponent_ng_container_2_ng_container_2_Template, 3, 1, \"ng-container\", 0);\n    i0.ɵɵtemplate(3, ShareModalComponent_ng_container_2_ng_container_3_Template, 12, 6, \"ng-container\", 0);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    let tmp_0_0;\n    let tmp_1_0;\n    let tmp_2_0;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r2.data == null ? null : ctx_r2.data.wheel == null ? null : (tmp_0_0 = ctx_r2.data.wheel.getInput()) == null ? null : tmp_0_0.reachableDisplays == null ? null : tmp_0_0.reachableDisplays.length) == 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r2.data == null ? null : ctx_r2.data.wheel == null ? null : (tmp_1_0 = ctx_r2.data.wheel.getInput()) == null ? null : tmp_1_0.reachableDisplays == null ? null : tmp_1_0.reachableDisplays.length) == 1);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r2.data == null ? null : ctx_r2.data.wheel == null ? null : (tmp_2_0 = ctx_r2.data.wheel.getInput()) == null ? null : tmp_2_0.reachableDisplays == null ? null : tmp_2_0.reachableDisplays.length) > 1);\n  }\n}\nexport let ShareModalComponent = /*#__PURE__*/(() => {\n  var _class;\n  class ShareModalComponent {\n    constructor(ref, ds, command, graph, dialog, data) {\n      _defineProperty(this, \"ref\", void 0);\n      _defineProperty(this, \"ds\", void 0);\n      _defineProperty(this, \"command\", void 0);\n      _defineProperty(this, \"graph\", void 0);\n      _defineProperty(this, \"dialog\", void 0);\n      _defineProperty(this, \"data\", void 0);\n      _defineProperty(this, \"colMap\", [1, 1, 2, 3, 4, 3, 3, 4, 4, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4]);\n      _defineProperty(this, \"selections\", void 0);\n      _defineProperty(this, \"selected\", void 0);\n      _defineProperty(this, \"curInput\", () => {\n        if (!this.data) {\n          return null;\n        }\n        if (!this.data.wheel) {\n          return null;\n        }\n        return this.data.wheel.getInput();\n      });\n      _defineProperty(this, \"cancel\", () => {\n        this.command.buttonPress(\"close share modal\");\n        this.ref.close();\n      });\n      _defineProperty(this, \"toggle\", p => {\n        const i = this.selected.indexOf(p);\n        if (i === -1) {\n          this.command.buttonPress(\"add preset to share group\", p.name);\n          this.selected.push(p);\n        } else {\n          this.command.buttonPress(\"remove preset from share group\", p.name);\n          this.selected.splice(i, 1);\n        }\n      });\n      this.ref = ref;\n      this.ds = ds;\n      this.command = command;\n      this.graph = graph;\n      this.dialog = dialog;\n      this.data = data;\n    }\n    ngOnInit() {\n      console.log(\"share modal data:\", this.data);\n      if (!this.data || !this.data.wheel) {\n        console.warn(\"wheel was undefined when modal opened.\");\n        this.ref.close();\n      }\n      if (!this.curInput() || this.curInput().reachableDisplays.length === 0 || this.curInput().reachableDisplays.length === 1) {\n        setTimeout(() => {\n          this.ref.close();\n        }, 4000);\n        return;\n      }\n      this.selections = [];\n      // create the selected presets list\n      this.graph.getPresetList().forEach(pname => {\n        // skip the displays in my preset\n        if (this.data.wheel.preset.name === pname) {\n          return;\n        }\n        // find the preset that this display is correlated with\n        const preset = this.ds.presets.find(p => p.name === pname);\n        // skip it if i already have it\n        if (this.selections.includes(preset)) {\n          return;\n        }\n        // skip this preset if one of it's displays can't get this input\n        for (const disp of preset.displays) {\n          if (!this.curInput().reachableDisplays.includes(disp.name)) {\n            return;\n          }\n        }\n        this.selections.push(preset);\n      });\n      if (this.selections.length === 0) {\n        setTimeout(() => {\n          this.ref.close();\n        }, 4000);\n      }\n      // select all of the presets\n      this.selected = this.selections.slice();\n    }\n  }\n  _class = ShareModalComponent;\n  _defineProperty(ShareModalComponent, \"\\u0275fac\", function ShareModalComponent_Factory(t) {\n    return new (t || _class)(i0.ɵɵdirectiveInject(i1.MatDialogRef), i0.ɵɵdirectiveInject(i2.DataService), i0.ɵɵdirectiveInject(i3.CommandService), i0.ɵɵdirectiveInject(i4.GraphService), i0.ɵɵdirectiveInject(i1.MatDialog), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA));\n  });\n  _defineProperty(ShareModalComponent, \"\\u0275cmp\", /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _class,\n    selectors: [[\"sharemodal\"]],\n    decls: 3,\n    vars: 3,\n    consts: [[4, \"ngIf\"], [\"mat-dialog-content\", \"\", 1, \"text\"], [\"mat-dialog-title\", \"\", 1, \"text\", \"title\"], [\"mat-dialog-content\", \"\", 1, \"\"], [\"rowHeight\", \"75\", 3, \"cols\"], [3, \"colspan\", \"rowspan\", \"click\", \"press\", 4, \"ngFor\", \"ngForOf\"], [\"mat-dialog-actions\", \"\", 1, \"items\", \"secondary-theme\"], [\"mat-raised-button\", \"\", \"color\", \"warn\", 3, \"disabled\", \"click\", \"press\"], [\"type\", \"mat-raised-button\", \"color\", \"primary\", \"spinnerColor\", \"accent\", 3, \"click\", \"press\", \"success\"], [\"button\", \"\"], [3, \"colspan\", \"rowspan\", \"click\", \"press\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", 4, \"ngIf\"], [\"mat-raised-button\", \"\", \"style\", \"background-color: rgba(255, 255, 255, 0.12)\", 4, \"ngIf\"], [\"mat-raised-button\", \"\", \"color\", \"accent\"], [\"mat-raised-button\", \"\", 2, \"background-color\", \"rgba(255, 255, 255, 0.12)\"]],\n    template: function ShareModalComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, ShareModalComponent_ng_container_0_Template, 3, 0, \"ng-container\", 0);\n        i0.ɵɵtemplate(1, ShareModalComponent_ng_container_1_Template, 3, 0, \"ng-container\", 0);\n        i0.ɵɵtemplate(2, ShareModalComponent_ng_container_2_Template, 4, 3, \"ng-container\", 0);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", (ctx.selections == null ? null : ctx.selections.length) === 0);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", (ctx.selections == null ? null : ctx.selections.length) > 0 && !(ctx.data == null ? null : ctx.data.wheel == null ? null : ctx.data.wheel.getInput()));\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"ngIf\", (ctx.selections == null ? null : ctx.selections.length) > 0 && (ctx.data == null ? null : ctx.data.wheel == null ? null : ctx.data.wheel.getInput()));\n      }\n    },\n    dependencies: [i5.NgForOf, i5.NgIf, i6.MatButton, i1.MatDialogTitle, i1.MatDialogContent, i1.MatDialogActions, i7.MatGridList, i7.MatGridTile, i8.ActivityButtonComponent],\n    styles: [\".text[_ngcontent-%COMP%]{text-align:center;font-family:Roboto,Helvetica Neue,sans-serif;font-size:1.3em}.text.title[_ngcontent-%COMP%]{font-size:1.7em}.items[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center}activity-button[_ngcontent-%COMP%]{margin-left:8px}.mat-grid-tile[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:15vw}\"]\n  }));\n  return ShareModalComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}