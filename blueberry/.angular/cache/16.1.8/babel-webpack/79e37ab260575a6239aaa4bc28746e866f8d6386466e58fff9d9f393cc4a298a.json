{"ast":null,"code":"import _defineProperty from \"/home/orcrist/Desktop/touchpanel-ui-microservice/blueberry/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport { __esDecorate, __runInitializers } from \"tslib\";\nimport { EventEmitter } from \"@angular/core\";\nimport { $WebSocket } from \"angular2-websocket/angular2-websocket\";\nimport { JsonConvert, JsonObject, JsonProperty, Any, JsonConverter } from \"json2typescript\";\nimport * as i0 from \"@angular/core\";\nexport const OPEN = \"open\";\nexport const CLOSE = \"close\";\nexport const MESSAGE = \"message\";\nexport let SocketService = /*#__PURE__*/(() => {\n  var _class;\n  class SocketService {\n    constructor() {\n      _defineProperty(this, \"url\", void 0);\n      _defineProperty(this, \"socket\", void 0);\n      _defineProperty(this, \"listener\", void 0);\n      _defineProperty(this, \"http\", void 0);\n      _defineProperty(this, \"webSocketConfig\", {\n        initialTimeout: 100,\n        maxTimeout: 500,\n        reconnectIfNotNormalClose: true\n      });\n      _defineProperty(this, \"screenoff\", void 0);\n      this.url = \"ws://\" + location.hostname + \":8888/websocket\";\n      this.socket = new $WebSocket(this.url, null, this.webSocketConfig);\n      this.listener = new EventEmitter();\n      this.screenoff = false;\n      const jsonConvert = new JsonConvert();\n      jsonConvert.ignorePrimitiveChecks = false;\n      this.socket.onMessage(msg => {\n        if (msg.data.includes(\"keepalive\")) {} else if (msg.data.includes(\"refresh\")) {\n          console.log(\"refreshing!\");\n          location.assign(\"http://\" + location.hostname + \":8888/\");\n        } else if (msg.data.includes(\"screenoff\")) {\n          console.log(\"adding screenoff element\");\n          this.screenoff = true;\n        } else if (msg.data.includes(\"websocketTest\")) {\n          console.log(\"socket test\");\n        } else {\n          const data = JSON.parse(msg.data);\n          const event = jsonConvert.deserialize(data, Event);\n          console.debug(\"received event\", event);\n          this.listener.emit({\n            type: MESSAGE,\n            data: event\n          });\n        }\n      }, {\n        autoApply: false\n      });\n      this.socket.onOpen(msg => {\n        console.log(\"Websocket opened with\", this.url, \":\", msg);\n        this.listener.emit({\n          type: OPEN\n        });\n      });\n      this.socket.onError(msg => {\n        console.log(\"websocket closed.\", msg);\n        this.listener.emit({\n          type: CLOSE\n        });\n      });\n      this.socket.onClose(msg => {\n        console.log(\"trying again\", msg);\n      });\n    }\n    close() {\n      this.socket.close(false);\n    }\n    getEventListener() {\n      return this.listener;\n    }\n  }\n  _class = SocketService;\n  _defineProperty(SocketService, \"\\u0275fac\", function SocketService_Factory(t) {\n    return new (t || _class)();\n  });\n  _defineProperty(SocketService, \"\\u0275prov\", /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: _class,\n    factory: _class.ɵfac\n  }));\n  return SocketService;\n})();\nlet BasicRoomInfo = (_class2 => {\n  let _classDecorators = [JsonObject(\"BasicRoomInfo\")];\n  let _classDescriptor;\n  let _classExtraInitializers = [];\n  let _classThis;\n  let _instanceExtraInitializers = [];\n  let _BuildingID_decorators;\n  let _BuildingID_initializers = [];\n  let _RoomID_decorators;\n  let _RoomID_initializers = [];\n  var _BasicRoomInfo = (_class2 = class BasicRoomInfo {\n    constructor(roomID) {\n      _defineProperty(this, \"BuildingID\", (__runInitializers(this, _instanceExtraInitializers), __runInitializers(this, _BuildingID_initializers, \"\")));\n      _defineProperty(this, \"RoomID\", __runInitializers(this, _RoomID_initializers, \"\"));\n      if (roomID == null || roomID === undefined) {\n        return;\n      }\n      const split = roomID.split(\"-\");\n      if (split.length === 2) {\n        this.BuildingID = split[0];\n        this.RoomID = split[0] + \"-\" + split[1];\n      }\n    }\n  }, _classThis = _class2, (() => {\n    const _metadata = typeof Symbol === \"function\" && Symbol.metadata ? Object.create(null) : void 0;\n    _BuildingID_decorators = [JsonProperty(\"buildingID\", String, true)];\n    _RoomID_decorators = [JsonProperty(\"roomID\", String, true)];\n    __esDecorate(null, null, _BuildingID_decorators, {\n      kind: \"field\",\n      name: \"BuildingID\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"BuildingID\" in obj,\n        get: obj => obj.BuildingID,\n        set: (obj, value) => {\n          obj.BuildingID = value;\n        }\n      },\n      metadata: _metadata\n    }, _BuildingID_initializers, _instanceExtraInitializers);\n    __esDecorate(null, null, _RoomID_decorators, {\n      kind: \"field\",\n      name: \"RoomID\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"RoomID\" in obj,\n        get: obj => obj.RoomID,\n        set: (obj, value) => {\n          obj.RoomID = value;\n        }\n      },\n      metadata: _metadata\n    }, _RoomID_initializers, _instanceExtraInitializers);\n    __esDecorate(null, _classDescriptor = {\n      value: _classThis\n    }, _classDecorators, {\n      kind: \"class\",\n      name: _classThis.name,\n      metadata: _metadata\n    }, null, _classExtraInitializers);\n    _BasicRoomInfo = _classThis = _classDescriptor.value;\n    if (_metadata) Object.defineProperty(_classThis, Symbol.metadata, {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: _metadata\n    });\n    __runInitializers(_classThis, _classExtraInitializers);\n  })(), _class2);\n  return _BasicRoomInfo = _classThis;\n})();\nexport { BasicRoomInfo };\nlet BasicDeviceInfo = (_class3 => {\n  let _classDecorators = [JsonObject(\"BasicDeviceInfo\")];\n  let _classDescriptor;\n  let _classExtraInitializers = [];\n  let _classThis;\n  let _instanceExtraInitializers = [];\n  let _BuildingID_decorators;\n  let _BuildingID_initializers = [];\n  let _RoomID_decorators;\n  let _RoomID_initializers = [];\n  let _DeviceID_decorators;\n  let _DeviceID_initializers = [];\n  var _BasicDeviceInfo = (_class3 = class BasicDeviceInfo {\n    constructor(deviceID) {\n      _defineProperty(this, \"BuildingID\", (__runInitializers(this, _instanceExtraInitializers), __runInitializers(this, _BuildingID_initializers, \"\")));\n      _defineProperty(this, \"RoomID\", __runInitializers(this, _RoomID_initializers, \"\"));\n      _defineProperty(this, \"DeviceID\", __runInitializers(this, _DeviceID_initializers, \"\"));\n      if (deviceID == null || deviceID === undefined) {\n        return;\n      }\n      const split = deviceID.split(\"-\");\n      if (split.length === 3) {\n        this.BuildingID = split[0];\n        this.RoomID = split[0] + \"-\" + split[1];\n        this.DeviceID = split[0] + \"-\" + split[1] + \"-\" + split[2];\n      }\n    }\n  }, _classThis = _class3, (() => {\n    const _metadata = typeof Symbol === \"function\" && Symbol.metadata ? Object.create(null) : void 0;\n    _BuildingID_decorators = [JsonProperty(\"buildingID\", String, true)];\n    _RoomID_decorators = [JsonProperty(\"roomID\", String, true)];\n    _DeviceID_decorators = [JsonProperty(\"deviceID\", String, true)];\n    __esDecorate(null, null, _BuildingID_decorators, {\n      kind: \"field\",\n      name: \"BuildingID\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"BuildingID\" in obj,\n        get: obj => obj.BuildingID,\n        set: (obj, value) => {\n          obj.BuildingID = value;\n        }\n      },\n      metadata: _metadata\n    }, _BuildingID_initializers, _instanceExtraInitializers);\n    __esDecorate(null, null, _RoomID_decorators, {\n      kind: \"field\",\n      name: \"RoomID\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"RoomID\" in obj,\n        get: obj => obj.RoomID,\n        set: (obj, value) => {\n          obj.RoomID = value;\n        }\n      },\n      metadata: _metadata\n    }, _RoomID_initializers, _instanceExtraInitializers);\n    __esDecorate(null, null, _DeviceID_decorators, {\n      kind: \"field\",\n      name: \"DeviceID\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"DeviceID\" in obj,\n        get: obj => obj.DeviceID,\n        set: (obj, value) => {\n          obj.DeviceID = value;\n        }\n      },\n      metadata: _metadata\n    }, _DeviceID_initializers, _instanceExtraInitializers);\n    __esDecorate(null, _classDescriptor = {\n      value: _classThis\n    }, _classDecorators, {\n      kind: \"class\",\n      name: _classThis.name,\n      metadata: _metadata\n    }, null, _classExtraInitializers);\n    _BasicDeviceInfo = _classThis = _classDescriptor.value;\n    if (_metadata) Object.defineProperty(_classThis, Symbol.metadata, {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: _metadata\n    });\n    __runInitializers(_classThis, _classExtraInitializers);\n  })(), _class3);\n  return _BasicDeviceInfo = _classThis;\n})();\nexport { BasicDeviceInfo };\nlet DateConverter = (_class4 => {\n  let _classDecorators = [JsonConverter];\n  let _classDescriptor;\n  let _classExtraInitializers = [];\n  let _classThis;\n  var _DateConverter = (_class4 = class DateConverter {\n    serialize(date) {\n      function pad(n) {\n        return n < 10 ? \"0\" + n : n;\n      }\n      return date.getUTCFullYear() + \"-\" + pad(date.getUTCMonth() + 1) + \"-\" + pad(date.getUTCDate()) + \"T\" + pad(date.getUTCHours()) + \":\" + pad(date.getUTCMinutes()) + \":\" + pad(date.getUTCSeconds()) + \"Z\";\n    }\n    deserialize(date) {\n      return new Date(date);\n    }\n  }, _classThis = _class4, (() => {\n    const _metadata = typeof Symbol === \"function\" && Symbol.metadata ? Object.create(null) : void 0;\n    __esDecorate(null, _classDescriptor = {\n      value: _classThis\n    }, _classDecorators, {\n      kind: \"class\",\n      name: _classThis.name,\n      metadata: _metadata\n    }, null, _classExtraInitializers);\n    _DateConverter = _classThis = _classDescriptor.value;\n    if (_metadata) Object.defineProperty(_classThis, Symbol.metadata, {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: _metadata\n    });\n    __runInitializers(_classThis, _classExtraInitializers);\n  })(), _class4);\n  return _DateConverter = _classThis;\n})();\nlet Event = (_class5 => {\n  let _classDecorators = [JsonObject(\"Event\")];\n  let _classDescriptor;\n  let _classExtraInitializers = [];\n  let _classThis;\n  let _instanceExtraInitializers = [];\n  let _GeneratingSystem_decorators;\n  let _GeneratingSystem_initializers = [];\n  let _Timestamp_decorators;\n  let _Timestamp_initializers = [];\n  let _EventTags_decorators;\n  let _EventTags_initializers = [];\n  let _TargetDevice_decorators;\n  let _TargetDevice_initializers = [];\n  let _AffectedRoom_decorators;\n  let _AffectedRoom_initializers = [];\n  let _Key_decorators;\n  let _Key_initializers = [];\n  let _Value_decorators;\n  let _Value_initializers = [];\n  let _User_decorators;\n  let _User_initializers = [];\n  let _Data_decorators;\n  let _Data_initializers = [];\n  var _Event = (_class5 = class Event {\n    hasTag(tag) {\n      return this.EventTags.includes(tag);\n    }\n    constructor() {\n      _defineProperty(this, \"GeneratingSystem\", (__runInitializers(this, _instanceExtraInitializers), __runInitializers(this, _GeneratingSystem_initializers, undefined)));\n      _defineProperty(this, \"Timestamp\", __runInitializers(this, _Timestamp_initializers, undefined));\n      _defineProperty(this, \"EventTags\", __runInitializers(this, _EventTags_initializers, new Array()));\n      _defineProperty(this, \"TargetDevice\", __runInitializers(this, _TargetDevice_initializers, undefined));\n      _defineProperty(this, \"AffectedRoom\", __runInitializers(this, _AffectedRoom_initializers, undefined));\n      _defineProperty(this, \"Key\", __runInitializers(this, _Key_initializers, undefined));\n      _defineProperty(this, \"Value\", __runInitializers(this, _Value_initializers, undefined));\n      _defineProperty(this, \"User\", __runInitializers(this, _User_initializers, undefined));\n      _defineProperty(this, \"Data\", __runInitializers(this, _Data_initializers, undefined));\n      this.TargetDevice = new BasicDeviceInfo(undefined);\n      this.AffectedRoom = new BasicRoomInfo(undefined);\n    }\n  }, _classThis = _class5, (() => {\n    const _metadata = typeof Symbol === \"function\" && Symbol.metadata ? Object.create(null) : void 0;\n    _GeneratingSystem_decorators = [JsonProperty(\"generating-system\", String, true)];\n    _Timestamp_decorators = [JsonProperty(\"timestamp\", DateConverter, true)];\n    _EventTags_decorators = [JsonProperty(\"event-tags\", [String], true)];\n    _TargetDevice_decorators = [JsonProperty(\"target-device\", BasicDeviceInfo, true)];\n    _AffectedRoom_decorators = [JsonProperty(\"affected-room\", BasicRoomInfo)];\n    _Key_decorators = [JsonProperty(\"key\", String, true)];\n    _Value_decorators = [JsonProperty(\"value\", String, true)];\n    _User_decorators = [JsonProperty(\"user\", String, true)];\n    _Data_decorators = [JsonProperty(\"data\", Any, true)];\n    __esDecorate(null, null, _GeneratingSystem_decorators, {\n      kind: \"field\",\n      name: \"GeneratingSystem\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"GeneratingSystem\" in obj,\n        get: obj => obj.GeneratingSystem,\n        set: (obj, value) => {\n          obj.GeneratingSystem = value;\n        }\n      },\n      metadata: _metadata\n    }, _GeneratingSystem_initializers, _instanceExtraInitializers);\n    __esDecorate(null, null, _Timestamp_decorators, {\n      kind: \"field\",\n      name: \"Timestamp\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"Timestamp\" in obj,\n        get: obj => obj.Timestamp,\n        set: (obj, value) => {\n          obj.Timestamp = value;\n        }\n      },\n      metadata: _metadata\n    }, _Timestamp_initializers, _instanceExtraInitializers);\n    __esDecorate(null, null, _EventTags_decorators, {\n      kind: \"field\",\n      name: \"EventTags\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"EventTags\" in obj,\n        get: obj => obj.EventTags,\n        set: (obj, value) => {\n          obj.EventTags = value;\n        }\n      },\n      metadata: _metadata\n    }, _EventTags_initializers, _instanceExtraInitializers);\n    __esDecorate(null, null, _TargetDevice_decorators, {\n      kind: \"field\",\n      name: \"TargetDevice\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"TargetDevice\" in obj,\n        get: obj => obj.TargetDevice,\n        set: (obj, value) => {\n          obj.TargetDevice = value;\n        }\n      },\n      metadata: _metadata\n    }, _TargetDevice_initializers, _instanceExtraInitializers);\n    __esDecorate(null, null, _AffectedRoom_decorators, {\n      kind: \"field\",\n      name: \"AffectedRoom\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"AffectedRoom\" in obj,\n        get: obj => obj.AffectedRoom,\n        set: (obj, value) => {\n          obj.AffectedRoom = value;\n        }\n      },\n      metadata: _metadata\n    }, _AffectedRoom_initializers, _instanceExtraInitializers);\n    __esDecorate(null, null, _Key_decorators, {\n      kind: \"field\",\n      name: \"Key\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"Key\" in obj,\n        get: obj => obj.Key,\n        set: (obj, value) => {\n          obj.Key = value;\n        }\n      },\n      metadata: _metadata\n    }, _Key_initializers, _instanceExtraInitializers);\n    __esDecorate(null, null, _Value_decorators, {\n      kind: \"field\",\n      name: \"Value\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"Value\" in obj,\n        get: obj => obj.Value,\n        set: (obj, value) => {\n          obj.Value = value;\n        }\n      },\n      metadata: _metadata\n    }, _Value_initializers, _instanceExtraInitializers);\n    __esDecorate(null, null, _User_decorators, {\n      kind: \"field\",\n      name: \"User\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"User\" in obj,\n        get: obj => obj.User,\n        set: (obj, value) => {\n          obj.User = value;\n        }\n      },\n      metadata: _metadata\n    }, _User_initializers, _instanceExtraInitializers);\n    __esDecorate(null, null, _Data_decorators, {\n      kind: \"field\",\n      name: \"Data\",\n      static: false,\n      private: false,\n      access: {\n        has: obj => \"Data\" in obj,\n        get: obj => obj.Data,\n        set: (obj, value) => {\n          obj.Data = value;\n        }\n      },\n      metadata: _metadata\n    }, _Data_initializers, _instanceExtraInitializers);\n    __esDecorate(null, _classDescriptor = {\n      value: _classThis\n    }, _classDecorators, {\n      kind: \"class\",\n      name: _classThis.name,\n      metadata: _metadata\n    }, null, _classExtraInitializers);\n    _Event = _classThis = _classDescriptor.value;\n    if (_metadata) Object.defineProperty(_classThis, Symbol.metadata, {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: _metadata\n    });\n    __runInitializers(_classThis, _classExtraInitializers);\n  })(), _class5);\n  return _Event = _classThis;\n})();\nexport { Event };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}